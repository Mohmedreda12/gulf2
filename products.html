<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="pageTitle">المنتجات</title>
  <style>
    body{margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    .container{width:min(1100px,92vw);margin:auto}
    header{position:sticky;top:0;background:#101827;border-bottom:1px solid rgba(255,255,255,.08);z-index:2}
    .nav{display:flex;justify-content:space-between;align-items:center;padding:.8rem 0}
    .tabs{display:flex;gap:.5rem;flex-wrap:wrap;margin:1rem 0}
    .tab{padding:.45rem .8rem;border-radius:.6rem;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);cursor:pointer}
    .tab.active{background:#ff6a00;color:#111827;border-color:#ff6a00}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.9rem;margin:1rem 0 2rem}
    @media (max-width:950px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:.8rem;overflow:hidden}
    .img{aspect-ratio:4/3;background:#0f172a}
    .img img{width:100%;height:100%;object-fit:cover;display:block}
    .body{padding:.85rem}
    .body h3{margin:.2rem 0 .45rem;font-size:1rem}
    .body p{margin:0;color:#a3b2c5;line-height:1.6}
    .muted{color:#a3b2c5}
    .btn{border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);padding:.5rem .8rem;border-radius:.6rem}
  </style>
</head>
<body>
<header>
  <div class="container nav">
    <div style="display:flex;gap:.6rem;align-items:center">
      <strong id="brandMain">مصممون الخليج للملابس</strong>
      <span class="muted" style="font-size:.9rem" id="brandSub">Gulf Uniform Designers Plant</span>
    </div>
    <div style="display:flex;gap:.5rem">
      <a class="btn" id="homeBtn" href="index.html">الرئيسية</a>
      <a class="btn" id="adminBtn" href="admin.html">الإدارة</a>
      <button class="btn" id="langBtn" type="button">EN</button>
    </div>
  </div>
</header>

<main class="container">
  <h1 id="title" style="font-size:1.25rem;margin:1rem 0 .3rem">المنتجات</h1>
  <div class="muted" id="hint">اختر القسم لعرض المنتجات</div>

  <div id="tabs" class="tabs" role="tablist" aria-label="الأقسام"></div>
  <section id="grid" class="grid" aria-live="polite"></section>
</main>

<!-- Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  /* ===== Supabase config ===== */
  const SUPABASE_URL = "https://nwymwhwwbgadcjyrrvyc.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53eW13aHd3YmdhZGNqeXJydnljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzODkzMjYsImV4cCI6MjA3Mzk2NTMyNn0.K6vOyGus_mbmwn-BPlS5BVKzIzbWc7r_m_c4MsynPRA";
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  /* ===== i18n ===== */
  let lang = localStorage.getItem('gu_lang') || 'ar';
  const t = (ar,en)=> (lang==='ar'? ar : en);

  const UI = {
    brandMain: ['مصممون الخليج للملابس', 'Gulf Uniform Designers Plant'],
    brandSub:  ['Gulf Uniform Designers Plant', 'مصممون الخليج للملابس'],
    home:      ['الرئيسية','Home'],
    admin:     ['الإدارة','Admin'],
    title:     ['المنتجات','Products'],
    pick:      ['اختر القسم لعرض المنتجات','Pick a category to view products'],
    loading:   ['جارٍ التحميل...','Loading...'],
    error:     ['حدث خطأ في الجلب','Failed to fetch'],
    empty:     ['لا توجد منتجات بعد','No products yet'],
    count:     ['عدد المنتجات: ','Products count: '],
    noName:    ['(بدون اسم)','(No name)']
  };

  const CATS = {
    fr:          { ar:'ملابس مقاومة للحريق (FR)', en:'Flame-Resistant (FR) Workwear' },
    med_schools:{ ar:'القطاع الطبي + المدارس',     en:'Medical + Schools' },
    sec_hosp:   { ar:'الأمن + المطاعم والضيافة',    en:'Security + Hospitality' }
  };

  const tabsWrap = document.getElementById('tabs');
  const grid = document.getElementById('grid');
  const hint = document.getElementById('hint');

  function applyChrome(){
    document.documentElement.lang = lang;
    document.documentElement.dir  = (lang==='ar'?'rtl':'ltr');
    document.getElementById('pageTitle').textContent = t(UI.title[0], UI.title[1]);
    document.getElementById('brandMain').textContent = t(...UI.brandMain);
    document.getElementById('brandSub').textContent  = t(...UI.brandSub);
    document.getElementById('homeBtn').textContent   = t(...UI.home);
    document.getElementById('adminBtn').textContent  = t(...UI.admin);
    document.getElementById('title').textContent     = t(...UI.title);
    hint.textContent = t(...UI.pick);
    document.getElementById('langBtn').textContent = (lang==='ar'?'EN':'AR');

    // حدث نصوص التبويبات
    document.querySelectorAll('#tabs .tab').forEach(btn=>{
      const k=btn.dataset.cat; btn.textContent = CATS[k][lang];
    });
  }

  document.getElementById('langBtn').onclick = ()=>{
    lang = (lang==='ar'?'en':'ar');
    localStorage.setItem('gu_lang', lang);
    applyChrome();
    // أعد تحميل القسم الحالي حتى تتحدث رسالة العداد
    selectCat(currentCat);
  };

  // إنشاء التبويبات مرة واحدة
  Object.entries(CATS).forEach(([value, lbl], i)=>{
    const b=document.createElement('button');
    b.className='tab'+(i===0?' active':'');
    b.dataset.cat=value;
    b.textContent=lbl[lang];
    b.onclick=()=> selectCat(value);
    tabsWrap.appendChild(b);
  });

  function setActive(cat){
    document.querySelectorAll('.tab').forEach(b=>{
      b.classList.toggle('active', b.dataset.cat===cat);
    });
  }

  let currentCat = 'fr';

  async function selectCat(cat){
    currentCat = cat;
    setActive(cat);
    hint.textContent = t(...UI.loading);
    grid.innerHTML = '';

    const { data, error } = await sb
      .from('products')
      .select('*')
      .eq('category', cat)
      .order('created_at', { ascending:false });

    if(error){ hint.textContent = t(...UI.error); return; }
    if(!data || !data.length){ hint.textContent = t(...UI.empty); return; }

    hint.textContent = t(UI.count[0], UI.count[1]) + data.length;

    grid.innerHTML = data.map(p=>`
      <article class="card">
        <div class="img">
          <img src="${p.image_url || ''}" alt="">
        </div>
        <div class="body">
          <h3>${(p.title && p.title.trim()) || t(...UI.noName)}</h3>
          <p>${p.description || ''}</p>
        </div>
      </article>
    `).join('');
  }

  // تشغيل أولي
  applyChrome();
  selectCat('fr');
</script>
</body>
</html>

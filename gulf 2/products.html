<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>منتجاتنا</title>
<style>
  body{margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:inherit;text-decoration:none}
  .container{width:min(1100px,92vw);margin:auto}
  header{position:sticky;top:0;background:#101827;border-bottom:1px solid rgba(255,255,255,.08);z-index:2}
  .nav{display:flex;justify-content:space-between;align-items:center;padding:.8rem 0}
  .tabs{display:flex;gap:.5rem;flex-wrap:wrap;margin:1rem 0}
  .tab{padding:.45rem .8rem;border-radius:.6rem;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);cursor:pointer}
  .tab.active{background:#ff6a00;color:#111827;border-color:#ff6a00}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.9rem;margin:1rem 0 2rem}
  @media (max-width:950px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}}
  .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:.8rem;overflow:hidden}
  .img{aspect-ratio:4/3;background:#0f172a}
  .img img{width:100%;height:100%;object-fit:cover;display:block}
  .body{padding:.85rem}
  .body h3{margin:.2rem 0 .45rem;font-size:1rem}
  .body p{margin:0;color:#a3b2c5;line-height:1.6}
  .muted{color:#a3b2c5}
  .btn{border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);padding:.5rem .8rem;border-radius:.6rem}
</style>
</head>
<body>
<header>
  <div class="container nav">
    <div style="display:flex;gap:.6rem;align-items:center">
      <strong id="brandAr">مصممون الخليج للملابس</strong>
      <span class="muted" style="font-size:.9rem" id="brandEn">Gulf Uniform Designers Plant</span>
    </div>
    <div style="display:flex;gap:.5rem">
      <a class="btn" href="index.html" id="homeBtn">الرئيسية</a>
      <a class="btn" href="admin.html" id="adminBtn">الإدارة</a>
      <button class="btn" id="langBtn" type="button">EN</button>
    </div>
  </div>
</header>

<main class="container">
  <h1 id="title" style="font-size:1.25rem;margin:1rem 0 .3rem">المنتجات</h1>
  <div class="muted" id="hint">اختر القسم لعرض المنتجات</div>

  <div id="tabs" class="tabs" role="tablist" aria-label="الأقسام"></div>
  <section id="grid" class="grid" aria-live="polite"></section>
</main>

<script>
  // ===== مفاتيح وأقسام مدموجة =====
  const KEY = 'gu_catalog_v3';
  const CATS = {
    fr:          { ar:'ملابس مقاومة للحريق (FR)',      en:'Flame-Resistant (FR) Workwear' },
    med_schools:{ ar:'القطاع الطبي + المدارس',        en:'Medical + Schools' },
    sec_hosp:   { ar:'الأمن + المطاعم والضيافة',       en:'Security + Hospitality' }
  };

  const demoPic = {
    fr:'/a1/rrr.jpg',
    med_schools:'a1/d1.jpg',
    sec_hosp:'a1/f1.jpg'
  };

  function loadDB(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return { fr:[], med_schools:[], sec_hosp:[] };
      const obj = JSON.parse(raw);
      if(!obj.fr) obj.fr=[]; if(!obj.med_schools) obj.med_schools=[]; if(!obj.sec_hosp) obj.sec_hosp=[];
      return obj;
    }catch(e){ return { fr:[], med_schools:[], sec_hosp:[] }; }
  }

  const db   = loadDB();
  const tabs = document.getElementById('tabs');
  const grid = document.getElementById('grid');

  // --- اختيار القسم من الهاش ---
  function mapToTab(v){
    if(!v) return null;
    v = v.toLowerCase();
    if (v === 'fr') return 'fr';
    if (v === 'sec_hosp' || v === 'security' || v === 'hospitality') return 'sec_hosp';
    if (v === 'med_schools' || v === 'medical' || v === 'schools') return 'med_schools';
    return null;
  }
  let current = mapToTab(location.hash.slice(1)) || 'fr';

  // === اللغة (يحفظ الاختيار) ===
  let lang = localStorage.getItem('gu_lang') || 'ar';
  const t = (ar,en)=> (lang==='ar'? ar : en);

  function applyLangChrome(){
    document.documentElement.lang = lang;
    document.documentElement.dir  = (lang==='ar'?'rtl':'ltr');
    document.getElementById('langBtn').textContent = (lang==='ar'?'EN':'AR');
    document.getElementById('homeBtn').textContent = t('الرئيسية','Home');
    document.getElementById('adminBtn').textContent= t('الإدارة','Admin');
    document.getElementById('brandAr').textContent = t('مصممون الخليج للملابس','Gulf Uniform Designers Plant');
    document.getElementById('brandEn').textContent = t('Gulf Uniform Designers Plant','مصممون الخليج للملابس');
    document.getElementById('title').textContent   = t('المنتجات','Products');
    document.getElementById('hint').textContent    = t('اختر القسم لعرض المنتجات','Pick a category to view products');
    document.querySelectorAll('#tabs .tab').forEach(btn=>{
      const k = btn.dataset.cat;
      btn.textContent = CATS[k][lang];
    });
  }

  document.getElementById('langBtn').addEventListener('click', ()=>{
    lang = (lang==='ar'?'en':'ar');
    localStorage.setItem('gu_lang', lang);
    applyLangChrome();
    render();
  });

  // --- إنشاء التبويبات مرة واحدة ---
  Object.entries(CATS).forEach(([k,label],i)=>{
    const b=document.createElement('button');
    b.className='tab'+(i===0?' active':'');
    b.dataset.cat=k;
    b.textContent=label[lang];
    b.onclick = ()=>{ location.hash = k; };
    tabs.appendChild(b);
  });

  // --- تفعيل الزر النشط + متابعة تغيّر الهاش ---
  function setActiveTab(){
    document.querySelectorAll('#tabs .tab').forEach(t=>{
      t.classList.toggle('active', t.dataset.cat === current);
    });
  }
  window.addEventListener('hashchange', ()=>{
    const target = mapToTab(location.hash.slice(1));
    if (target && target !== current){
      current = target;
      setActiveTab();
      render();
    }
  });

  function render(){
    document.getElementById('title').textContent = t('منتجات قسم ','Category: ') + CATS[current][lang];

    const empty = [{
      title_ar:t('منتج تجريبي','Sample item'),
      title_en:'Sample item',
      desc_ar:t('وصف مختصر…','Short description…'),
      desc_en:'Short description…',
      img:demoPic[current]
    }];

    const list = (db[current] && db[current].length) ? db[current] : empty;
    document.getElementById('hint').textContent = t('عدد العناصر: ','Items: ') + list.length;

    grid.innerHTML='';
    list.forEach(it=>{
      const card=document.createElement('article'); card.className='card';
      const img=document.createElement('div'); img.className='img';
      const im=document.createElement('img'); im.src = it.img || demoPic[current]; im.alt='';
      img.appendChild(im);
      const body=document.createElement('div'); body.className='body';
      const h3=document.createElement('h3'); h3.textContent = (lang==='ar' ? (it.title_ar||it.title_en||'منتج') : (it.title_en||it.title_ar||'Item'));
      const p=document.createElement('p');  p.textContent = (lang==='ar' ? (it.desc_ar||it.desc_en||'—') : (it.desc_en||it.desc_ar||'—'));
      body.appendChild(h3); body.appendChild(p);
      card.appendChild(img); card.appendChild(body);
      grid.appendChild(card);
    });
  }

  // تشغيل أولي
  applyLangChrome();
  setActiveTab();
  render();
</script>
</body>
</html>
